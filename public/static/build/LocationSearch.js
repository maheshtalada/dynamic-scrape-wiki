(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{"2BKT":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return Q}));o("pVnL");var a=o("gcR/"),n=o.n(a),r=o("lSNA"),i=o.n(r),s=o("lwsE"),c=o.n(s),l=o("a1gu"),u=o.n(l),h=o("Nsbk"),p=o.n(h),d=o("PJYZ"),g=o.n(d),S=o("W8MJ"),m=o.n(S),v=o("7W2i"),y=o.n(v),f=o("q1tI"),P=o("17x9"),b=o.n(P),k=o("hgbD"),w=o.n(k),C=o("BezJ"),L=o.n(C),T=o("vDqi"),R=o.n(T),O=o("OhLk"),N=o("wZnF"),E=o("TTUQ"),x=o("E+oP"),M=o.n(x),_=o("ylYN"),I=o("sEfC"),V=o.n(I),q=o("r39Y");function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(o,!0).forEach((function(t){i()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var j=q.default.api,A=q.default.endpoints,G=q.default.gmap,D=q.default.localeSettings,B=q.default.cookies,H=q.default.searchStateCode,F=3,K=n()(_.default,{}),J=n()("i",{className:"pe-7s-search"}),Q=function(e){function LocationSearch(e,t){var o;return c()(this,LocationSearch),(o=u()(this,p()(LocationSearch).call(this,e))).initPlaceSuggest=o.initPlaceSuggest.bind(g()(o)),o.updatePlace=o.updatePlace.bind(g()(o)),o.keyPress=o.keyPress.bind(g()(o)),o.handleGooglePlacesPredictions=o.handleGooglePlacesPredictions.bind(g()(o)),o.placeAutoComplete=null,o.state={location:"",searchText:"",showGeolocation:!0,showLocationFetchError:!1,propertySuggestions:[],addressSuggestions:[],searchTerm:e.searchQueryValue||"",searchType:e.searchType.split("?")[0],contentSearchterm:e.urlSearchTerm,noLocationError:!1},o.getPredictions=V()(o.getPredictions,e.getPredictionsDelay),o.updateLocationSearchValue(e),o.onClickSearch=o.onClickSearch.bind(g()(o)),o.searchCharMinLength=e.searchCharMinLength||F,o}return y()(LocationSearch,e),m()(LocationSearch,null,[{key:"getSearchInputValue",value:function getSearchInputValue(e,t,o,a){return"content"===e?o:a}}]),m()(LocationSearch,[{key:"componentDidMount",value:function componentDidMount(){var e=this;void 0===window.google?w()(_objectSpread({},G)).then((function(t){e.initPlaceSuggest(t)})):this.initPlaceSuggest(window.google.maps)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){var t=this.state,o=t.searchType,a=t.searchTerm,n=e.searchType.split("?")[0];e&&(this.setState({location:e.location,searchType:n,contentSearchterm:a,propertySuggestions:[],noLocationError:e.noLocationError,searchTerm:e.searchQueryValue||this.state.searchTerm||""}),this.props.isPropertyLookupRequired&&a.length>=this.searchCharMinLength&&n!==o&&"realtor"!==n&&"content"!==n&&"professional"!==n&&this.getSuggestions(n)),this.updateLocationSearchValue(e)}},{key:"updateLocationSearchValue",value:function updateLocationSearchValue(e){e.multipleLocations?this.locationSearchValue="":this.locationSearchValue=e.searchQueryValue}},{key:"updateCookies",value:function updateCookies(e,t,o){L.a.save("locationradius",o,{path:"/",maxAge:108e7,secure:B.isSecure}),L.a.save("locationquery",e,{path:"/",maxAge:108e7,secure:B.isSecure}),L.a.save("locationname",t,{path:"/",maxAge:108e7,secure:B.isSecure})}},{key:"initPlaceSuggest",value:function initPlaceSuggest(e){this.autoCompleteService=new e.places.AutocompleteService,this.placesService=new e.places.PlacesService(document.createElement("div"))}},{key:"getSuggestions",value:function getSuggestions(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=t||this.props.searchType;if(("realtor"!==(o=o.split("?")[0])||"content"!==o)&&"professional"!==o){var a=this.context.country,n=this.state.searchTerm,r=Object.assign({countrycode:a}),i={method:"GET",url:"".concat(j.protocol,"://").concat(j.host,":").concat(j.port).concat(j.prefix).concat(A.listingsuggestions).concat(n).replace("{listingtype}",o),headers:r};this.setState({loading:!0}),R()(i).then((function(t){e.setState({loading:!1,propertySuggestions:t.data||[]})}),(function(t){e.setState({loading:!1}),console.log(t)}))}}},{key:"getPredictions",value:function getPredictions(e){var t=this;if(frameworkGlobals.location=e,this.locationSearchValue=e,"content"===this.state.searchType)return this.setState({contentSearchterm:e}),void(frameworkGlobals.contentQuery=e);var o=this.context.country;e.length<this.searchCharMinLength?this.setState({addressSuggestions:[],propertySuggestions:[],showGeolocation:!0}):((e=e?e.trim():"").length>=this.searchCharMinLength&&this.autoCompleteService.getPlacePredictions({input:e,types:this.props.placeTypes,componentRestrictions:{country:D[o].locationSearchRegion}},this.handleGooglePlacesPredictions),this.setState({showGeolocation:!e,showLocationFetchError:!1,noLocationError:!1},(function(){t.props.onChange&&t.props.onChange(t.locationSearchValue)})))}},{key:"handleGooglePlacesPredictions",value:function handleGooglePlacesPredictions(e,t){if("OK"===t){if(H&&this.props.isRestrictMetrosRequired){var o=new RegExp(H,"gi");e=e.filter((function(e){return e.structured_formatting.secondary_text&&e.structured_formatting.secondary_text.match(o)}))}e=e.sort((function(e,t){return e.description.length<=t.description.length?0:1})),this.setState({addressSuggestions:e.slice(0,3),loading:!1},this.props.isPropertyLookupRequired?this.getSuggestions:null)}else this.setState({addressSuggestions:[],loading:!1},this.props.isPropertyLookupRequired?this.getSuggestions:null)}},{key:"onClickSearch",value:function onClickSearch(){var e=this.state,t=e.addressSuggestions,o=e.searchTerm;o&&t&&t.length?this.placeSelected(t[0]):this.props.onSearch&&this.props.onSearch(o,"list")}},{key:"placeSelected",value:function placeSelected(e,t){var o=this;if(e.place_id)this.placesService.getDetails({placeId:e.place_id},(function(e,a){a===google.maps.places.PlacesServiceStatus.OK&&o.updatePlace(e,t)}));else{if(this.props.isPDPRedirectRequired){var a=document.createElement("a");return a.setAttribute("href",e.uri),void a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}this.locationSearchValue=e.name,this.props.onPlaceSelect&&this.props.onPlaceSelect(_objectSpread({listingId:e.id},e),map)}}},{key:"updatePlace",value:function updatePlace(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],e.geometry.location,this.context.country);t=t||e.formatted_address;var a="";e.geometry||(e={formatted_address:L.a.load("locationname")||"",location:L.a.load("locationquery")||""}),e.geometry&&(a=Object(E.u)(e.geometry.viewport,Object(N.d)(o,"earthRadius"))),frameworkGlobals.location=t,this.props.multipleLocations?this.locationSearchValue="":this.locationSearchValue=t,this.props.onPlaceSelect&&this.props.onPlaceSelect(e,a,"list")}},{key:"render",value:function render(){var e=this,t=this.state,o=t.propertySuggestions,a=t.searchTerm,r=t.addressSuggestions,i=(t.showGeolocation,t.showLocationFetchError,t.searchType),s=t.noLocationError,c=t.inputBarValue,l=void 0===c?"":c,u=t.loading,h=this.context.i18n.l,p=this.context,d=(p.visitorCountry,p.country,p.assetsPath),g=(p.screenSize,LocationSearch.getSearchInputValue(i,this.context.location,this.state.contentSearchterm,this.locationSearchValue),r.concat(o)),S=this.props,m=S.placeHolder,v=S.showMetroServedNote,y=S.multipleLocations,P=S.inputAutoFocus,b=void 0!==P&&P,k=S.isSearchBtnTextRequired,w=S.isSearchBtnIconRequired,C=void 0===w||w,L=S.isSearchBtnRequired,T=(S.isRestrictMetrosRequired,S.searchBtnContent),R=S.renderNoMatchNote,N=S.isNoMatchNoteRequired;return n()("div",{className:"location-search flex"},void 0,n()("div",{className:"autocomplete-wrapper ".concat(s?"no-search-input":"")},void 0,n()(O.a,{value:a,inputProps:{id:"states-autocomplete",placeholder:h(m),autoFocus:b},items:g||[],getItemValue:function getItemValue(e){return e.description||e.name},onSelect:function onSelect(t,o){e.setState({searchTerm:y?"":t}),e.placeSelected(o,t)},onChange:function onChange(t,o){e.setState({loading:!0,inputBarValue:o,searchTerm:o}),e.getPredictions(o)},renderItem:function renderItem(t,o,a,n){return e.renderAutoCompleteItem(t,o,a,n)},renderMenu:function renderMenu(t,o,a){return!u&&l.length>=e.searchCharMinLength&&N?n()("div",{className:"autocomplete-menu"},void 0,M()(t)&&l.length>=e.searchCharMinLength?n()("div",{className:"autocomplete-menu__no-matches-found"},void 0,n()("div",{className:"autocomplete-menu__item-status"},void 0,"No matches found for ",n()("span",{className:"search-term"},void 0,o)),v&&K,R&&R()):e.renderItems(t),n()("div",{className:"autocomplete-menu__google-icon"},void 0,n()("img",{src:"".concat(d,"/images/powered-by-google.png"),alt:"google"}))):null}}),!1,s&&n()("div",{className:"no-location-error alert alert-warning"},void 0,n()("div",{},void 0,h("CHOOSELOCATIONTOSEARCH")))),this.props.children&&this.props.children,L&&n()("button",{className:"btn btn-primary toolbar-group search-btn","aria-label":"search","data-tag-label":"Search Go","data-tag-category":"Home Search Tabs","data-tag-action":"Search Go Click",onClick:this.onClickSearch},void 0,T?T():n()(f.Fragment,{},void 0,k&&n()("span",{},void 0,h("SEARCH")),C&&J)))}},{key:"renderItems",value:function renderItems(e){var t=this.context.i18n.l;return e.map((function(o,a){var r=o.props["data-item-type"];if(0===a||e[a-1].props["data-item-type"]!==r){return[n()("div",{style:{background:"#eee",color:"#454545",padding:"2px 6px",fontWeight:"bold"}},void 0,t(r)),o]}return o}))}},{key:"keyPress",value:function keyPress(e){var t=this.state.searchTerm;13!==e.keyCode||this.props.onSearch&&this.props.onSearch(t,"list")}},{key:"renderAutoCompleteItem",value:function renderAutoCompleteItem(e,t,o,a){var r=new RegExp("^"+e,"gi"),i=(o.description||"".concat(o.name,' - <span class="item-price">').concat(Object(N.f)(Number(o.price),"","",this.context.country),"</span>")).replace(r,'<span style="font-weight:bold;">'.concat(e,"</span>")),s=this.props.gaTags;return n()("div",{className:"autocomplete-menu__item ".concat(a&&"highlight"),"data-tag-category":s.category,"data-tag-action":s.action,"data-tag-label":s.label,"data-item-type":o.place_id?"MATCHINGADDRESSES":"MATCHINGPROPERTIES"},o.place_id||o.id,n()("i",{className:o.place_id?"pe-7s-map-marker":"pe-7s-residential"}),n()("span",{dangerouslySetInnerHTML:{__html:i}}))}}]),LocationSearch}(f.Component);Q.defaultProps={cityObj:{},placeHolder:"ENTERLOCATION",locationText:"",onPlaceSelect:function onPlaceSelect(){},onSearch:function onSearch(){},multipleLocations:!1,isPDPRedirectRequired:!0,isSearchBtnRequired:!0,searchType:"",isPropertyLookupRequired:!0,isRestrictMetrosRequired:!0,gaTags:{},isNoMatchNoteRequired:!0,getPredictionsDelay:200,showMetroServedNote:!0},Q.contextTypes={i18n:b.a.object,location:b.a.string,country:b.a.string,visitorCountry:b.a.string,assetsPath:b.a.string,screenSize:b.a.number}}}]);