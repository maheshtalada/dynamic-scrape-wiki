(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{"9Ykg":function(e,n,t){"use strict";t.d(n,"a",(function(){return I}));var o=t("gcR/"),r=t.n(o),a=t("lSNA"),i=t.n(a),s=t("lwsE"),l=t.n(s),c=t("W8MJ"),u=t.n(c),p=t("a1gu"),d=t.n(p),m=t("Nsbk"),g=t.n(m),k=t("PJYZ"),h=t.n(k),f=t("7W2i"),v=t.n(f),M=t("q1tI"),y=t("17x9"),w=t.n(y),b=t("TSYQ"),C=t.n(b),L=t("TTUQ");function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}var O=r()("span",{},void 0,"1"),P=r()("i",{className:"pe-7s-close-3"}),S=r()("div",{className:"listing-map-marker__info__caret"}),I=function(e){function ListingMapMarker(e){var n;return l()(this,ListingMapMarker),(n=d()(this,g()(ListingMapMarker).call(this,e))).state={markerIndex:e.markerIndex},n.onMarkerMouseLeave=n.onMarkerMouseLeave.bind(h()(n)),n.onMarkerInfoClose=n.onMarkerInfoClose.bind(h()(n)),n}return v()(ListingMapMarker,e),u()(ListingMapMarker,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){this.setState({markerIndex:e.markerIndex})}},{key:"onClickMarkerInfo",value:function onClickMarkerInfo(e){var n=document.createElement("a");n.setAttribute("href",e),n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}},{key:"onMarkerClick",value:function onMarkerClick(e,n){this.setState({markerShown:n})}},{key:"onMarkerMouseEnter",value:function onMarkerMouseEnter(e,n){this.setState({markerHovered:n})}},{key:"onMarkerMouseLeave",value:function onMarkerMouseLeave(e){this.setState({markerHovered:-1})}},{key:"onMarkerInfoClose",value:function onMarkerInfoClose(e){e.stopPropagation(),this.setState({markerShown:-1})}},{key:"render",value:function render(){var e=this,n=this.props.listing,t=this.state,o=t.markerShown,a=t.markerHovered,s=t.markerIndex,l=this.context,c=(l.i18n.l,l.country,l.awsImagePath,o===s?"marker-shown":""),u=a===s?"marker-hovered":"",p=this.props.$geoService.getWidth(),d=this.props.$geoService.getHeight(),m=function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(t,!0).forEach((function(n){i()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({width:35,height:35},this.props.$getDimensions(this.props.$dimensionKey)),g=Object(L.p)(p,d,m,278,206);return r()("div",{className:"listing-map-marker",onMouseLeave:this.onMarkerMouseLeave},void 0,r()("div",{id:"marker-".concat(n.id),onMouseEnter:function onMouseEnter(){e.onMarkerMouseEnter(n.id,s)},onClick:function onClick(){e.onMarkerClick(n.id,s)},className:C()("listing-map-marker__marker",c,u)},void 0,O),r()("div",{style:g.style,id:"marker-info-".concat(n.id),onClick:function onClick(){e.onClickMarkerInfo(n.listingurl)},className:C()("listing-map-marker__info",c,u,g.posClass)},void 0,c&&r()("button",{className:"close-btn",onClick:this.onMarkerInfoClose},void 0,P),S,this.props.renderMarkerInfo(n,s)))}}]),ListingMapMarker}(M.Component);I.contextTypes={i18n:w.a.object,country:w.a.string,awsImagePath:w.a.string}},sEFx:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"default",(function(){return Z}));var o=t("lSNA"),r=t.n(o),a=t("lwsE"),i=t.n(a),s=t("a1gu"),l=t.n(s),c=t("Nsbk"),u=t.n(c),p=t("W8MJ"),d=t.n(p),m=t("7W2i"),g=t.n(m),k=t("gcR/"),h=t.n(k),f=t("q1tI"),v=t("17x9"),M=t.n(v),y=t("Dxlp"),w=t.n(y),b=t("o6DS"),C=t("3WF5"),L=t.n(C),O=t("9Ykg"),P=t("mPD7"),S=t.n(P),I=t("jYsY"),D=t("MKeS"),j=t("r39Y");function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}var B=Object(D.a)((function(){return t.e(53).then(t.bind(null,"JQAT"))})),E=j.default.gmap;"undefined"==typeof window&&(e.window=new Object,e.document=new Object);var N=function createMapOptions(e){return{panControl:!0,mapTypeControl:!0,scrollwheel:!1,streetViewControl:!0,maxZoom:20,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.LEFT_TOP}}};var x=function ClusterMarker(e){var n=e.count,t=e.clusterId,o=void 0===t?"":t,r=e.lat,a=e.lng,i=e.onClusterClick,s=e.points,l=e.zoom;return h()("div",{className:"listing-map-marker",onClick:function onClick(e){return i(r,a,o,s,l)}},void 0,h()("div",{className:"listing-map-marker__marker cluster"},void 0,n))};var _=9,Z=function(e){function LocationDetailMap(e){var n;return i()(this,LocationDetailMap),(n=l()(this,u()(LocationDetailMap).call(this,e)))._onDragEnd=function(e,t,o){var r=t.getBounds(),a=r.getNorthEast(),i=r.getSouthWest();n.setState({mode:"bound",map:t,currentCluster:""}),n.props.onBoundChange&&e&&n.props.onBoundChange(a.lat(),a.lng(),i.lat(),i.lng())},n._onZoomChange=function(e,t,o){var r=n.state,a=(r.initialLoad,r.zoom,t.getBounds());a.getNorthEast(),a.getSouthWest();!n.isLoadData&&n.props.onBoundChange&&e&&n.setState({zoom:t.getZoom(),clusterId:"",loadMarkers:!1,currentCluster:""}),n.isLoadData=!1},n._onZoomAnimationEnd=function(e,t,o){n.setState({loadMarkers:!0})},n.state={center:LocationDetailMap.getMapCenter(e.lat,e.lon,e.mapBounds),lat:e.lat,lon:e.lon,mapBounds:e.mapBounds,zoom:_,map:"",maps:"",mode:"",initialLoad:!0,infoWindow:"",listings:e.listings,typeIcons:L()(b.a,(function(e){return r()({},e.code,e["icon-class"])}))},n.markers=[],n.place="",n.bounds="",n.initialZoom=_,n}return g()(LocationDetailMap,e),d()(LocationDetailMap,null,[{key:"getMapCenter",value:function getMapCenter(e,n,t){if(e&&n)return[e,n];if(t){var o=t.split(",");return[(Number(o[0])+Number(o[2]))/2,(Number(o[1])+Number(o[3]))/2]}}},{key:"pointsToZoom",value:function pointsToZoom(e,n,t,o){var r=L()(e,o.lat).sort((function(e,n){return e-n}))[0],a=L()(e,o.lat).sort((function(e,n){return n-e}))[0],i=L()(e,o.lng).sort((function(e,n){return e-n}))[0],s=L()(e,o.lng).sort((function(e,n){return n-e}))[0];return console.log(r,a,i,s),n.fitBounds(new t.LatLngBounds(new t.LatLng(r,i),new t.LatLng(a,s))),n.getZoom()}}]),d()(LocationDetailMap,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){var n=this,t=this.state,o=t.map,r=void 0===o?"":o,a=t.maps,i=void 0===a?"":a;t.mode;e&&void 0!==e.isFetching&&!e.isFetching&&"stop-render"!==e.markerIndex&&this.setState({currentCluster:"",listings:e.listings,mapBounds:e.mapBounds||this.state.mapBounds,markerHovered:e.markerIndex},(function(){if(i)!e.isBoundsApply&&function fitBoundsNeSw(e,n,t){var o=e.split(","),r=new n.LatLng(o[0],o[1]),a=new n.LatLng(o[2],o[3]),i=new n.LatLngBounds(a,r);return t.fitBounds(i),t}(n.state.mapBounds,i,r)}))}},{key:"onMapLoad",value:function onMapLoad(e,n){var t=this.state,o=t.listings,r=(t.mapBounds,t.zoom),a=(this.props.mapmovetxt,LocationDetailMap.pointsToZoom(o,e,n,{lat:"geometry.lat",lng:"geometry.lon"}));this.setState({map:e,maps:n,zoom:LocationDetailMap.pointsToZoom(o,e,n,{lat:"geometry.lat",lng:"geometry.lon"}),currentCluster:"",loadMarkers:r===a})}},{key:"onClusterClick",value:function onClusterClick(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3?arguments[3]:void 0,r=(arguments.length>4&&arguments[4],this.state),a=(r.zoom,r.map),i=r.maps;this.setState({center:{lat:e,lng:n},clusterId:t,zoom:LocationDetailMap.pointsToZoom(o,a,i,{lat:"geometry.lat",lng:"geometry.lon"}),loadMarkers:!1,currentCluster:o})}},{key:"renderMarkerInfo",value:function renderMarkerInfo(e){var n=this.props.searchFacets,t=this.context,o=t.country,r=t.i18n,a=t.awsImagePath;return h()("div",{},void 0,h()(I.a,{},void 0,h()(B,{listing:e,screenSize:this.props.screenSize,location:this.props.location,user:this.props.user,dispatch:this.props.dispatch,facets:n,country:o,l:r.l,renderBundleBox:e.bundles&&this.props.renderBundleBox,awsImagePath:a})))}},{key:"renderMarker",value:function renderMarker(e,n){var t=this,o=e.numPoints,r=e.wx,a=e.wy,i=e.points,s=e.zoom;return 1===o?h()(O.a,{lat:a,lng:r,markerIndex:n,renderMarkerInfo:function renderMarkerInfo(){return t.renderMarkerInfo(i[0])},listing:i[0]},i[0].id):h()(x,{lat:a,lng:r,count:o,points:i,zoom:s,markerIndex:n,onClusterClick:this.onClusterClick.bind(this)},i[0].id)}},{key:"renderMarkers",value:function renderMarkers(){var e=this,n=this.state,t=n.listings,o=(n.markerHovered,n.markerShown,n.map),a=n.zoom,i=(n.clusterId,n.currentCluster),s=void 0===i?"":i,l=o.getBounds(),c=s||t,u=l.getNorthEast().lat(),p=l.getNorthEast().lng(),d=l.getSouthWest().lat(),m=l.getSouthWest().lng(),g=c.map((function(e){return function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(t,!0).forEach((function(n){r()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({id:e.id,lat:e.geometry.lat,lng:e.geometry.lon},e)})),k=S()(g,{minZoom:5,maxZoom:19,radius:40})({bounds:{nw:{lat:u,lng:m},se:{lat:d,lng:p}},zoom:a});return k&&k.length?k.map((function(n,t){return e.renderMarker(n,t)})):null}},{key:"render",value:function render(){var e=this,n=this.state,t=n.center,o=n.zoom,r=n.loadMarkers;n.id,n.listings;return h()("div",{id:"property-listings-map-container",className:"schema-map-wrapper"},void 0,h()(w.a,{center:t,onDragEnd:this._onDragEnd,onZoomChange:this._onZoomChange,onZoomAnimationEnd:this._onZoomAnimationEnd,onGoogleApiLoaded:function onGoogleApiLoaded(n){var t=n.map,o=n.maps;return e.onMapLoad(t,o)},zoom:o,options:N,bootstrapURLKeys:E},void 0,r&&this.renderMarkers()))}}]),LocationDetailMap}(f.Component);Z.contextTypes={router:M.a.object,i18n:M.a.object,awsImagePath:M.a.string},Z.defaultProps={height:560,lat:12.9833,lon:77.5833,onPositionChange:function onPositionChange(){},updatePlace:function updatePlace(){},locateProperty:function locateProperty(){},onBoundChange:function onBoundChange(){},isBoundsApply:!0}}.call(this,t("yLpj"))}}]);